{"ast":null,"code":"import axios from 'axios';\nimport { API_ROUTES } from '../utils/constants';\nconst API_URL = process.env.REACT_APP_API_URL;\nexport function formatBooks(bookArray) {\n  return bookArray.map(book => {\n    const newBook = {\n      ...book\n    };\n    // eslint-disable-next-line no-underscore-dangle\n    newBook.id = newBook._id;\n    if (newBook.imageUrl) {\n      newBook.imageUrl = `${API_URL}${newBook.imageUrl}`;\n    }\n    return newBook;\n  });\n}\nexport function storeInLocalStorage(token, userId) {\n  localStorage.setItem('token', token);\n  localStorage.setItem('userId', userId);\n}\nexport function getFromLocalStorage(item) {\n  return localStorage.getItem(item);\n}\nexport async function getAuthenticatedUser() {\n  const defaultReturnObject = {\n    authenticated: false,\n    user: null\n  };\n  try {\n    const token = getFromLocalStorage('token');\n    const userId = getFromLocalStorage('userId');\n    if (!token) {\n      return defaultReturnObject;\n    }\n    return {\n      authenticated: true,\n      user: {\n        userId,\n        token\n      }\n    };\n  } catch (err) {\n    console.error('getAuthenticatedUser, Something Went Wrong', err);\n    return defaultReturnObject;\n  }\n}\nexport async function getBooks() {\n  try {\n    const response = await axios({\n      method: 'GET',\n      url: `${API_ROUTES.BOOKS}`\n    });\n    // eslint-disable-next-line array-callback-return\n    const books = formatBooks(response.data);\n    return books;\n  } catch (err) {\n    console.error(err);\n    return [];\n  }\n}\nexport async function getBook(id) {\n  try {\n    const response = await axios({\n      method: 'GET',\n      url: `${API_ROUTES.BOOKS}/${id}`\n    });\n    const book = response.data;\n    // eslint-disable-next-line no-underscore-dangle\n    book.id = book._id;\n    return book;\n  } catch (err) {\n    console.error(err);\n    return null;\n  }\n}\nexport async function getBestRatedBooks() {\n  try {\n    const response = await axios({\n      method: 'GET',\n      url: `${API_ROUTES.BEST_RATED}`\n    });\n    return formatBooks(response.data);\n  } catch (e) {\n    console.error(e);\n    return [];\n  }\n}\nexport async function deleteBook(id) {\n  try {\n    await axios.delete(`${API_ROUTES.BOOKS}/${id}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    return true;\n  } catch (err) {\n    console.error(err);\n    return false;\n  }\n}\nexport async function rateBook(id, userId, rating) {\n  const data = {\n    userId,\n    rating: parseInt(rating, 10)\n  };\n  try {\n    const response = await axios.post(`${API_ROUTES.BOOKS}/${id}/rating`, data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    const book = response.data;\n    // eslint-disable-next-line no-underscore-dangle\n    book.id = book._id;\n    return book;\n  } catch (e) {\n    console.error(e);\n    return e.message;\n  }\n}\nexport async function addBook(data) {\n  const userId = localStorage.getItem('userId');\n  const bodyFormData = new FormData();\n  bodyFormData.append('userId', userId);\n  bodyFormData.append('title', data.title);\n  bodyFormData.append('author', data.author);\n  bodyFormData.append('year', data.year);\n  bodyFormData.append('genre', data.genre);\n  bodyFormData.append('ratings', JSON.stringify([{\n    userId,\n    grade: parseInt(data.rating, 10)\n  }]));\n  bodyFormData.append('image', data.file[0]);\n  try {\n    return await axios({\n      method: 'post',\n      url: `${API_ROUTES.BOOKS}`,\n      data: bodyFormData,\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n  } catch (err) {\n    console.error(err);\n    return {\n      error: true,\n      message: err.message\n    };\n  }\n}\nexport async function updateBook(data, id) {\n  const userId = localStorage.getItem('userId');\n  let newData;\n  const book = {\n    userId,\n    title: data.title,\n    author: data.author,\n    year: data.year,\n    genre: data.genre\n  };\n  if (data.file[0]) {\n    newData = new FormData();\n    newData.append('book', JSON.stringify(book));\n    newData.append('image', data.file[0]);\n  } else {\n    newData = {\n      ...book\n    };\n  }\n  try {\n    const newBook = await axios({\n      method: 'put',\n      url: `${API_ROUTES.BOOKS}/${id}`,\n      data: newData,\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem('token')}`\n      }\n    });\n    return newBook;\n  } catch (err) {\n    console.error(err);\n    return {\n      error: true,\n      message: err.message\n    };\n  }\n}","map":{"version":3,"names":["axios","API_ROUTES","API_URL","process","env","REACT_APP_API_URL","formatBooks","bookArray","map","book","newBook","id","_id","imageUrl","storeInLocalStorage","token","userId","localStorage","setItem","getFromLocalStorage","item","getItem","getAuthenticatedUser","defaultReturnObject","authenticated","user","err","console","error","getBooks","response","method","url","BOOKS","books","data","getBook","getBestRatedBooks","BEST_RATED","e","deleteBook","delete","headers","Authorization","rateBook","rating","parseInt","post","message","addBook","bodyFormData","FormData","append","title","author","year","genre","JSON","stringify","grade","file","updateBook","newData"],"sources":["C:/Users/antoi/Downloads/Projet-6-Backend/frontend/src/lib/common.js"],"sourcesContent":["import axios from 'axios';\r\nimport { API_ROUTES } from '../utils/constants';\r\nconst API_URL = process.env.REACT_APP_API_URL;\r\n\r\nexport function formatBooks(bookArray) {\r\n  return bookArray.map((book) => {\r\n    const newBook = { ...book };\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    newBook.id = newBook._id;\r\n    if (newBook.imageUrl) {\r\n      newBook.imageUrl = `${API_URL}${newBook.imageUrl}`;\r\n    }\r\n    return newBook;\r\n  });\r\n}\r\n\r\nexport function storeInLocalStorage(token, userId) {\r\n  localStorage.setItem('token', token);\r\n  localStorage.setItem('userId', userId);\r\n}\r\n\r\nexport function getFromLocalStorage(item) {\r\n  return localStorage.getItem(item);\r\n}\r\n\r\nexport async function getAuthenticatedUser() {\r\n  const defaultReturnObject = { authenticated: false, user: null };\r\n  try {\r\n    const token = getFromLocalStorage('token');\r\n    const userId = getFromLocalStorage('userId');\r\n    if (!token) {\r\n      return defaultReturnObject;\r\n    }\r\n    return { authenticated: true, user: { userId, token } };\r\n  } catch (err) {\r\n    console.error('getAuthenticatedUser, Something Went Wrong', err);\r\n    return defaultReturnObject;\r\n  }\r\n}\r\n\r\nexport async function getBooks() {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BOOKS}`,\r\n    });\r\n    // eslint-disable-next-line array-callback-return\r\n    const books = formatBooks(response.data);\r\n    return books;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getBook(id) {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BOOKS}/${id}`,\r\n    });\r\n    const book = response.data;\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    book.id = book._id;\r\n    return book;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getBestRatedBooks() {\r\n  try {\r\n    const response = await axios({\r\n      method: 'GET',\r\n      url: `${API_ROUTES.BEST_RATED}`,\r\n    });\r\n    return formatBooks(response.data);\r\n  } catch (e) {\r\n    console.error(e);\r\n    return [];\r\n  }\r\n}\r\nexport async function deleteBook(id) {\r\n  try {\r\n    await axios.delete(`${API_ROUTES.BOOKS}/${id}`, {\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    return true;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function rateBook(id, userId, rating) {\r\n  const data = {\r\n    userId,\r\n    rating: parseInt(rating, 10),\r\n  };\r\n\r\n  try {\r\n    const response = await axios.post(`${API_ROUTES.BOOKS}/${id}/rating`, data, {\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    const book = response.data;\r\n    // eslint-disable-next-line no-underscore-dangle\r\n    book.id = book._id;\r\n    return book;\r\n  } catch (e) {\r\n    console.error(e);\r\n    return e.message;\r\n  }\r\n}\r\n\r\nexport async function addBook(data) {\r\n  const userId = localStorage.getItem('userId');\r\n\r\n  const bodyFormData = new FormData();\r\n  bodyFormData.append('userId', userId);\r\n  bodyFormData.append('title', data.title);\r\n  bodyFormData.append('author', data.author);\r\n  bodyFormData.append('year', data.year);\r\n  bodyFormData.append('genre', data.genre);\r\n  bodyFormData.append('ratings', JSON.stringify([{ userId, grade: parseInt(data.rating, 10) }]));\r\n  bodyFormData.append('image', data.file[0]);\r\n\r\n  try {\r\n    return await axios({\r\n      method: 'post',\r\n      url: `${API_ROUTES.BOOKS}`,\r\n      data: bodyFormData,\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        'Content-Type': 'multipart/form-data',\r\n      },\r\n    });\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { error: true, message: err.message };\r\n  }\r\n}\r\n\r\nexport async function updateBook(data, id) {\r\n  const userId = localStorage.getItem('userId');\r\n\r\n  let newData;\r\n  const book = {\r\n    userId,\r\n    title: data.title,\r\n    author: data.author,\r\n    year: data.year,\r\n    genre: data.genre,\r\n  };\r\n  if (data.file[0]) {\r\n    newData = new FormData();\r\n    newData.append('book', JSON.stringify(book));\r\n    newData.append('image', data.file[0]);\r\n  } else {\r\n    newData = { ...book };\r\n  }\r\n\r\n  try {\r\n    const newBook = await axios({\r\n      method: 'put',\r\n      url: `${API_ROUTES.BOOKS}/${id}`,\r\n      data: newData,\r\n      headers: {\r\n        Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n      },\r\n    });\r\n    return newBook;\r\n  } catch (err) {\r\n    console.error(err);\r\n    return { error: true, message: err.message };\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}